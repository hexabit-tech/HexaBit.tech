<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>QR Code Generator</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
body {
  font-family: Segoe UI, Tahoma, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}
#qr-holder {
  width: 300px;
  height: 300px;
  margin: auto;
}
</style>
</head>

<body>

<h2 style="text-align:center">QRrrrrr Code Generator</h2>

<div style="max-width:400px;margin:auto">

<label>Text or URL</label>
<textarea id="data" oninput="updateQR()">https://example.com</textarea>

<br><br>

<label>QR Color</label>
<input type="color" id="qrColor" value="#000000" onchange="updateQR()">

<br><br>

<label>Background Color</label>
<input type="color" id="bgColor" value="#ffffff" onchange="updateQR()">

<br><br>

<label>
  <input type="checkbox" id="transparentBg" onchange="updateQR()"> Transparent Background
</label>

<br><br>

<label>
  <input type="checkbox" id="useLogo" onchange="toggleLogo()"> Add Center Logo
</label>

<div id="logoControls" style="display:none;margin-top:10px">

<input type="file" id="logoFile" accept="image/*">

<br><br>

<input type="text" id="logoUrl" placeholder="https://example.com/logo.png">

<br><br>

<label>Logo Size</label>
<input type="range" id="logoSize" min="15" max="40" value="25" oninput="updateQR()">
<span id="logoSizeVal">25%</span>

</div>

</div>

<br><br>

<div id="qr-holder"></div>

<br>

<div style="text-align:center">
<button onclick="downloadQR()">Download PNG</button>
</div>

<script>
let qrCode;
let currentLogo = null;

const dataEl = document.getElementById("data");
const qrColorEl = document.getElementById("qrColor");
const bgColorEl = document.getElementById("bgColor");
const transparentBgEl = document.getElementById("transparentBg");
const useLogoEl = document.getElementById("useLogo");
const logoFileEl = document.getElementById("logoFile");
const logoUrlEl = document.getElementById("logoUrl");
const logoSizeEl = document.getElementById("logoSize");
const logoSizeVal = document.getElementById("logoSizeVal");
const qrHolder = document.getElementById("qr-holder");

logoFileEl.addEventListener("change", e => {
  const file = e.target.files?.[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    currentLogo = ev.target.result; // ✅ PNG stays PNG
    logoUrlEl.value = "";
    updateQR(true);
  };
  reader.readAsDataURL(file);
});

logoUrlEl.addEventListener("input", () => {
  const url = logoUrlEl.value.trim();
  currentLogo = url || null;
  updateQR(true);
});

function toggleLogo() {
  document.getElementById("logoControls").style.display =
    useLogoEl.checked ? "block" : "none";
  updateQR(true);
}

function updateQR(force = false) {
  logoSizeVal.textContent = logoSizeEl.value + "%";

  const options = {
    data: dataEl.value || "https://example.com",
    width: 300,
    height: 300,
    dotsOptions: {
      color: qrColorEl.value,
      type: "square"
    },
    backgroundOptions: {
      color: transparentBgEl.checked ? "transparent" : bgColorEl.value
    }
  };

  if (useLogoEl.checked && currentLogo) {
    options.image = currentLogo;
    options.imageOptions = {
      crossOrigin: "anonymous",
      imageSize: logoSizeEl.value / 100, // ✅ correct size control
      margin: 8
    };
  }

  qrHolder.innerHTML = "";
  qrCode = new QRCodeStyling(options);
  qrCode.append(qrHolder);
}

function downloadQR() {
  qrCode.download({
    name: "qr-code",
    extension: "png"
  });
}

updateQR(true);
</script>

</body>
</html>
